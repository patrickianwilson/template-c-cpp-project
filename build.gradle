apply plugin: "cpp"
apply plugin: "google-test"

model {
	flavors {
        passing
        failing
    }
	components {
		echoer(NativeLibrarySpec) {
			
		}
		main(NativeExecutableSpec) {
			binaries.all {
				lib library: "echoer", linkage: 'static'
			}
		}
	
	}
	repositories {
		libs(PrebuiltLibraries) {
			googleTest {
				headers.srcDir "lib/gtest/headers/"
				binaries.withType(StaticLibraryBinary) {
					staticLibraryFile = file("lib/gtest/libgtest.a")
				}
			}
		}
	}
    binaries {
        withType(GoogleTestTestSuiteBinarySpec) {
            lib library: "googleTest", linkage: "static"

            if (flavor == flavors.failing) {
                cppCompiler.define "PLUS_BROKEN"
            }

            if (targetPlatform.operatingSystem.linux) {
                cppCompiler.args '-pthread'
                linker.args '-pthread'
            }
        }
    
	}

	// testSuites {
 //        echoerTest(GoogleTestTestSuiteSpec) {
 //            testing $.components.echoer
 //        }
 //    }
}

